<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syncord</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" href="https://syncordcdn.sirv.com/Images/Syncord.png" type="image/png">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <style>
        /* Your existing CSS */
    </style>
</head>
<body>
    <header>
        <div class="logo">Syncord</div>
        <div class="user-info">
            <img id="profile-pic" src="" alt="Profile Picture" style="display: none;">
            <span id="username" style="display: none;"></span>
        </div>
    </header>

    <main>
        <h1>Welcome to Syncord!</h1>
        <p>Your communication platform for seamless connections.</p>

        <div id="chat-container"></div>

        <div>
            <input type="text" id="message-input" placeholder="Type your message..." />
            <button id="send-button">Send</button>
        </div>
    </main>

    <script src="../script.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC65ZpkXJkyVJFOGZ9dDh14jmkQsRREQko",
            authDomain: "syncordsync.firebaseapp.com",
            projectId: "syncordsync",
            storageBucket: "syncordsync.appspot.com",
            messagingSenderId: "690747596328",
            appId: "1:690747596328:web:b169c6b54c18a8e517df1d"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        console.log("Firebase initialized successfully.");

        const userData = JSON.parse(localStorage.getItem('user'));
        if (userData) {
            document.getElementById('username').textContent = userData.username;
            document.getElementById('profile-pic').src = userData.profilePic;
            document.getElementById('profile-pic').style.display = 'block';
            document.getElementById('username').style.display = 'inline';
        }

        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        const loadMessages = () => {
            db.collection("messages").orderBy("timestamp")
                .onSnapshot(snapshot => {
                    chatContainer.innerHTML = ''; // Clear chat container
                    snapshot.forEach(doc => {
                        const message = doc.data();
                        const messageElement = document.createElement('div');
                        messageElement.textContent = `${message.username}: ${message.text}`;
                        chatContainer.appendChild(messageElement);
                    });
                    chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
                });
        };

        sendButton.addEventListener('click', () => {
            const messageText = messageInput.value;
            if (messageText) {
                console.log("Sending message:", messageText);
                db.collection("messages").add({
                    username: userData.username,
                    text: messageText,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    console.log("Message sent successfully!");
                    messageInput.value = '';
                })
                .catch((error) => {
                    console.error("Error sending message:", error);
                });
            }
        });

        loadMessages(); // Load messages on page load
    </script>
</body>
</html>
